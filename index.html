<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Backend Roadmap Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8f6fa;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            color: #6b5b95;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #9d89c7;
            margin-bottom: 10px;
        }
        
        .stat-label {
            color: #7f8c8d;
            font-size: 1.1em;
        }
        
        .jira-config {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .jira-config h3 {
            color: #6b5b95;
            margin-bottom: 15px;
        }
        
        .jira-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 500;
            margin-left: 10px;
        }
        
        .jira-connected { background: #e6f3e6; color: #27ae60; }
        .jira-disconnected { background: #ffe6e6; color: #e74c3c; }
        
        .config-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr auto;
            gap: 15px;
            align-items: end;
        }
        
        .sync-results {
            background: #f4f2f7;
            border: 1px solid #c8b9db;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            display: none;
        }
        
        .controls {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .controls-left {
            display: flex;
            gap: 10px;
        }
        
        .controls-right {
            color: #7f8c8d;
            font-size: 0.9em;
        }
        
        .btn {
            background: #9d89c7;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            margin-right: 10px;
            transition: background 0.3s;
        }
        
        .btn:hover {
            background: #8b7bb8;
        }
        
        .btn-success { background: #a89cc8; }
        .btn-success:hover { background: #9b8dc2; }
        
        .projects {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
        }
        
        .project-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        
        .project-card:hover {
            transform: translateY(-5px);
        }
        
        .project-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
        }
        
        .project-title {
            font-size: 1.4em;
            font-weight: 600;
            color: #6b5b95;
            margin-bottom: 8px;
        }
        
        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 500;
            margin-right: 8px;
        }
        
        .status-planning { background: #f4f2f7; color: #6b5b95; }
        .status-progress { background: #e8e3f0; color: #7c6ba0; }
        .status-completed { background: #e6f3e6; color: #27ae60; }
        .status-risk { background: #ffeaa7; color: #e17055; }
        .status-idea { background: #f9f7fb; color: #8b7bb8; }
        .status-ongoing { background: #f0eef5; color: #7c6ba0; }
        
        .priority {
            font-weight: 600;
            font-size: 0.9em;
        }
        
        .priority-high { color: #e74c3c; }
        .priority-medium { color: #f39c12; }
        .priority-low { color: #27ae60; }
        
        .project-info {
            margin: 15px 0;
            font-size: 0.95em;
            color: #7f8c8d;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #ecf0f1;
            border-radius: 4px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: #9d89c7;
            border-radius: 4px;
            transition: width 0.3s;
        }
        
        .blockers {
            background: #fff5f5;
            border: 1px solid #fed7d7;
            padding: 12px;
            border-radius: 8px;
            margin-top: 15px;
        }
        
        .blockers h4 {
            color: #e53e3e;
            margin-bottom: 5px;
            font-size: 0.9em;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            max-width: 600px;
            margin: 50px auto;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #6b5b95;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #bdc3c7;
            border-radius: 6px;
            font-size: 1em;
        }
        
        .form-group textarea {
            resize: vertical;
            height: 80px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .jira-notice {
            background: #f4f2f7;
            border: 1px solid #c8b9db;
            padding: 20px;
            border-radius: 12px;
            margin-top: 30px;
        }
        
        .jira-notice h4 {
            color: #6b5b95;
            margin-bottom: 10px;
        }
        
        .jira-notice p {
            color: #7c6ba0;
            font-size: 0.95em;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>Backend Team Roadmap</h1>
        </div>
        
        <!-- Stats -->
        <div class="stats">
            <div class="stat-card">
                <div class="stat-number" id="total-projects">2</div>
                <div class="stat-label">Total Projects</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="in-progress">1</div>
                <div class="stat-label">In Progress</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="completed">0</div>
                <div class="stat-label">Completed</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="at-risk">0</div>
                <div class="stat-label">At Risk</div>
            </div>
        </div>
        
        <!-- Progress Chart -->
        <canvas id="progressChart" style="margin-bottom: 30px; max-height: 300px;"></canvas>
        
        <!-- Jira Configuration -->
        <div class="jira-config">
            <h3>üîó Jira Integration <span class="jira-status jira-disconnected" id="jira-status">Disconnected</span></h3>
            <div class="config-row">
                <div class="form-group" style="margin-bottom: 0;">
                    <label>Jira Base URL</label>
                    <input type="url" id="jira-url" placeholder="https://yourcompany.atlassian.net" style="width: 100%; padding: 10px; border: 1px solid #bdc3c7; border-radius: 6px;">
                </div>
                <div class="form-group" style="margin-bottom: 0;">
                    <label>Email</label>
                    <input type="email" id="jira-email" placeholder="your-email" style="width: 100%; padding: 10px; border: 1px solid #bdc3c7; border-radius: 6px;">
                </div>
                <div class="form-group" style="margin-bottom: 0;">
                    <label>API Token</label>
                    <input type="password" id="jira-token" placeholder="Your API token" style="width: 100%; padding: 10px; border: 1px solid #bdc3c7; border-radius: 6px;">
                </div>
                <div>
                    <button class="btn" onclick="testJiraConnection()" style="margin-right: 5px;">Test Connection</button>
                    <button class="btn btn-success" onclick="syncWithJira()">Sync Projects</button>
                </div>
            </div>
            <div class="sync-results" id="sync-results"></div>
        </div>
        
        <!-- Controls -->
        <div class="controls">
            <div class="controls-left">
                <button class="btn" onclick="showAddForm()">‚ûï Add Project</button>
                <button class="btn btn-success" onclick="exportData()">üìä Export Data</button>
                <button class="btn" onclick="importFromJira()" id="import-btn" style="background: #7c6ba0;">üì• Import from Jira</button>
            </div>
            <div class="controls-right">
                üí° Tip: Click the üóëÔ∏è button on any project card to delete it
            </div>
        </div>
        
        <!-- Projects Grid -->
        <div class="projects" id="projects-container">
            <!-- Projects will be inserted here -->
        </div>
        
        <!-- Jira & GitLab Integration Notice -->
        <div class="jira-notice">
            <h4>üîó Integration Guide</h4>
            <p><strong>Step 1:</strong> Get your Jira API token from <a href="https://id.atlassian.com/manage-profile/security/api-tokens" target="_blank" style="color: #9d89c7;">id.atlassian.com</a></p>
            <p><strong>Step 2:</strong> Enter your Jira URL, email, and API token above</p>
            <p><strong>Step 3:</strong> Test connection and sync your epics automatically!</p>
            <p><strong>GitLab:</strong> Add repository links to projects for easy code access</p>
        </div>
    </div>
    
    <!-- Add Project Modal -->
    <div class="modal" id="project-modal">
        <div class="modal-content">
            <h2 id="modal-title">Add New Project</h2>
            <div class="form-row">
                <div class="form-group">
                    <label>Project Name *</label>
                    <input type="text" id="project-name" placeholder="Enter project name">
                </div>
                <div class="form-group">
                    <label>Owner</label>
                    <input type="text" id="project-owner" placeholder="e.g., Backend Team, John Doe">
                </div>
            </div>
            <div class="form-group">
                <label>Vision/Goal</label>
                <textarea id="project-vision" placeholder="What's the main vision or goal for this project?"></textarea>
            </div>
            <div class="form-group">
                <label>Scope/Features (one per line)</label>
                <textarea id="project-scope" placeholder="- Feature 1&#10;- Feature 2&#10;- Feature 3" style="height: 100px;"></textarea>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Team</label>
                    <input type="text" id="project-team" placeholder="e.g., Backend Team" value="Backend Team">
                </div>
                <div class="form-group">
                    <label>Priority</label>
                    <select id="project-priority">
                        <option value="High">High</option>
                        <option value="Medium" selected>Medium</option>
                        <option value="Low">Low</option>
                    </select>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Status</label>
                    <select id="project-status">
                        <option value="Idea">Idea</option>
                        <option value="Planning">Planning</option>
                        <option value="In Progress">In Progress</option>
                        <option value="Ongoing">Ongoing</option>
                        <option value="On Hold">On Hold</option>
                        <option value="Completed">Completed</option>
                        <option value="At Risk">At Risk</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Progress (%)</label>
                    <input type="number" id="project-progress" min="0" max="100" value="0">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Start Date</label>
                    <input type="date" id="project-start">
                </div>
                <div class="form-group">
                    <label>End Date</label>
                    <input type="date" id="project-end">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Jira Epic</label>
                    <input type="text" id="project-jira" placeholder="e.g., PLAT-123">
                </div>
                <div class="form-group">
                    <label>GitLab Repository</label>
                    <input type="url" id="project-gitlab" placeholder="https://gitlab.com/yourteam/project">
                </div>
            </div>
            <div class="form-group">
                <label>Description</label>
                <textarea id="project-description" placeholder="Brief project description"></textarea>
            </div>
            <div class="form-group">
                <label>Blockers (comma-separated)</label>
                <input type="text" id="project-blockers" placeholder="e.g., Security review, Resource allocation">
            </div>
            <div style="margin-top: 25px;">
                <button class="btn" onclick="saveProject()">Save Project</button>
                <button class="btn" onclick="hideModal()" style="background: #95a5a6;">Cancel</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Project data
        let projects = [
            {
                id: 1,
                name: "Agent/Listing/Service Tool",
                status: "Idea",
                priority: "High",
                startDate: "2024-09-15",
                endDate: "2024-12-01",
                progress: 5,
                team: "Backend Team",
                description: "Create a tool to centralize actions by Agent, Listing, Service, and Product",
                vision: "Reduces dependency on backend team, empowers support to resolve incidents faster",
                scope: ["Map Agents ‚Üí Listings", "Show incidents with High Priority", "Show root causes ‚Üí generate reports without dev effort", "Allow Support team to troubleshoot/fix issues in platform"],
                blockers: [],
                jiraEpic: "",
                gitlabUrl: "",
                owner: ""
            },
            {
                id: 2,
                name: "Notification Service (PNS)",
                status: "In Progress",
                priority: "High",
                startDate: "2024-08-01",
                endDate: "2024-11-30",
                progress: 60,
                team: "Backend Team",
                description: "The Purlin Notification Service (PNS) is a centralized, message-driven system responsible for delivering notifications across Purlin services (for all applications).",
                vision: "The Purlin Notification Service (PNS) is a centralized, message-driven system responsible for delivering notifications across Purlin services (for all applications). It separates notification logic from application code and ensures reliable, monitored, and auditable message delivery. Flexibility in communications, supports urgent ops messages.",
                scope: ["Support Subject + Body plain text emails", "Continue SendGrid templates"],
                blockers: [],
                jiraEpic: "",
                gitlabUrl: "",
                owner: "Samvel Melikjanyan"
            }
        ];

        let editingId = null;
        let jiraConfig = { url: '', email: '', token: '', connected: false };
        let idCounter = Math.max(...projects.map(p => p.id), 0) + 1;

        // Load projects and Jira config from storage
        function loadFromStorage() {
            try {
                const savedProjects = localStorage.getItem('projects');
                if (savedProjects) {
                    projects = JSON.parse(savedProjects);
                    idCounter = Math.max(...projects.map(p => p.id), 0) + 1;
                }
                const savedConfig = sessionStorage.getItem('jiraConfig');
                if (savedConfig) {
                    jiraConfig = JSON.parse(savedConfig);
                    document.getElementById('jira-url').value = jiraConfig.url;
                    document.getElementById('jira-email').value = jiraConfig.email;
                    document.getElementById('jira-token').value = jiraConfig.token;
                    if (jiraConfig.connected) updateJiraStatus(true);
                }
            } catch (e) {
                console.error('Error loading from storage:', e);
            }
        }

        // Save projects to localStorage
        function saveProjectsToStorage() {
            try {
                localStorage.setItem('projects', JSON.stringify(projects));
            } catch (e) {
                console.error('Error saving projects:', e);
            }
        }

        // Generate unique ID
        function generateId() {
            return idCounter++;
        }

        // Render projects
        function renderProjects() {
            const container = document.getElementById('projects-container');
            container.innerHTML = '';

            projects.forEach(project => {
                const statusClass = `status-${project.status.toLowerCase().replace(' ', '')}`;
                const priorityClass = `priority-${project.priority.toLowerCase()}`;
                const blockersHtml = project.blockers.length > 0 ? `
                    <div class="blockers">
                        <h4>‚ö†Ô∏è Blockers</h4>
                        <ul style="margin: 0; padding-left: 20px;">
                            ${project.blockers.map(b => `<li>${b}</li>`).join('')}
                        </ul>
                    </div>
                ` : '';

                const card = document.createElement('div');
                card.className = 'project-card';
                card.innerHTML = `
                    <div class="project-header">
                        <div style="flex: 1;">
                            <div class="project-title">${project.name}</div>
                            <div>
                                <span class="status ${statusClass}">${project.status}</span>
                                <span class="priority ${priorityClass}">${project.priority}</span>
                            </div>
                        </div>
                        <div>
                            <button class="btn" style="padding: 8px 12px; margin-right: 5px; font-size: 0.9em;" onclick="editProject(${project.id})">‚úèÔ∏è Edit</button>
                            <button class="btn" style="padding: 8px 12px; background: #e74c3c; font-size: 0.9em;" onclick="deleteProject(${project.id})">üóëÔ∏è Delete</button>
                        </div>
                    </div>
                    <div class="project-info">
                        <div><strong>Team:</strong> ${project.team}</div>
                        ${project.owner ? `<div><strong>Owner:</strong> ${project.owner}</div>` : ''}
                        <div><strong>Timeline:</strong> ${new Date(project.startDate).toLocaleDateString()} - ${new Date(project.endDate).toLocaleDateString()}</div>
                        ${project.jiraEpic ? `<div><strong>Epic:</strong> ${project.jiraEpic}</div>` : ''}
                        ${project.gitlabUrl ? `<div><strong>GitLab:</strong> <a href="${project.gitlabUrl}" target="_blank" style="color: #9d89c7; text-decoration: none;">üîó View Repository</a></div>` : ''}
                        ${project.description ? `<div><strong>Description:</strong> ${project.description}</div>` : ''}
                        ${project.vision ? `<div><strong>Vision/Goal:</strong> ${project.vision}</div>` : ''}
                        ${project.scope && project.scope.length > 0 ? `<div><strong>Scope:</strong><ul style="margin: 5px 0; padding-left: 20px;">${project.scope.map(item => `<li>${item}</li>`).join('')}</ul></div>` : ''}
                    </div>
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>Progress</span>
                            <span>${project.progress}%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${project.progress}%"></div>
                        </div>
                    </div>
                    ${blockersHtml}
                `;
                container.appendChild(card);
            });

            updateStats();
            renderProgressChart();
            saveProjectsToStorage();
        }

        // Update stats
        function updateStats() {
            document.getElementById('total-projects').textContent = projects.length;
            document.getElementById('in-progress').textContent = projects.filter(p => p.status === 'In Progress' || p.status === 'Ongoing').length;
            document.getElementById('completed').textContent = projects.filter(p => p.status === 'Completed').length;
            document.getElementById('at-risk').textContent = projects.filter(p => p.blockers.length > 0 || p.status === 'At Risk').length;
        }

        // Render progress chart
        function renderProgressChart() {
            const ctx = document.getElementById('progressChart')?.getContext('2d');
            if (!ctx) return;

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: projects.map(p => p.name),
                    datasets: [{
                        label: 'Project Progress (%)',
                        data: projects.map(p => p.progress),
                        backgroundColor: '#9d89c7',
                        borderColor: '#6b5b95',
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: { beginAtZero: true, max: 100 }
                    }
                }
            });
        }

        // Show add project form
        function showAddForm() {
            editingId = null;
            document.getElementById('modal-title').textContent = 'Add New Project';
            clearForm();
            document.getElementById('project-modal').style.display = 'block';
        }

        // Edit project
        function editProject(id) {
            const project = projects.find(p => p.id === id);
            if (!project) return;

            editingId = id;
            document.getElementById('modal-title').textContent = 'Edit Project';
            document.getElementById('project-name').value = project.name;
            document.getElementById('project-owner').value = project.owner || '';
            document.getElementById('project-team').value = project.team;
            document.getElementById('project-status').value = project.status;
            document.getElementById('project-priority').value = project.priority;
            document.getElementById('project-start').value = project.startDate;
            document.getElementById('project-end').value = project.endDate;
            document.getElementById('project-progress').value = project.progress;
            document.getElementById('project-jira').value = project.jiraEpic;
            document.getElementById('project-gitlab').value = project.gitlabUrl || '';
            document.getElementById('project-description').value = project.description;
            document.getElementById('project-vision').value = project.vision || '';
            document.getElementById('project-scope').value = project.scope ? project.scope.join('\n') : '';
            document.getElementById('project-blockers').value = project.blockers.join(', ');
            document.getElementById('project-modal').style.display = 'block';
        }

        // Delete project
        function deleteProject(id) {
            const project = projects.find(p => p.id === id);
            if (!project) return;

            if (confirm(`Are you sure you want to delete "${project.name}"?\n\nThis action cannot be undone.`)) {
                projects = projects.filter(p => p.id !== id);
                renderProjects();
                const successMsg = document.createElement('div');
                successMsg.innerHTML = `‚úÖ Project "${project.name}" has been deleted successfully`;
                successMsg.style.cssText = `
                    position: fixed; top: 20px; right: 20px; z-index: 9999;
                    background: #d4edda; color: #155724; border: 1px solid #c3e6cb;
                    padding: 12px 20px; border-radius: 8px; font-weight: 500;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                `;
                document.body.appendChild(successMsg);
                setTimeout(() => successMsg.remove(), 3000);
            }
        }

        // Save project
        function saveProject() {
            const name = document.getElementById('project-name').value.trim();
            const startDate = document.getElementById('project-start').value;
            const endDate = document.getElementById('project-end').value;
            const gitlabUrl = document.getElementById('project-gitlab').value.trim();
            const progress = parseInt(document.getElementById('project-progress').value) || 0;

            // Validation
            if (!name) {
                alert('Project name is required');
                return;
            }
            if (startDate && endDate && new Date(startDate) > new Date(endDate)) {
                alert('Start date must be before end date');
                return;
            }
            if (gitlabUrl && !/^(https?:\/\/)/.test(gitlabUrl)) {
                alert('Please enter a valid GitLab URL');
                return;
            }
            if (progress < 0 || progress > 100) {
                alert('Progress must be between 0 and 100');
                return;
            }

            const project = {
                name,
                owner: document.getElementById('project-owner').value.trim(),
                team: document.getElementById('project-team').value.trim() || 'Backend Team',
                status: document.getElementById('project-status').value,
                priority: document.getElementById('project-priority').value,
                startDate,
                endDate,
                progress,
                jiraEpic: document.getElementById('project-jira').value.trim(),
                gitlabUrl,
                description: document.getElementById('project-description').value.trim(),
                vision: document.getElementById('project-vision').value.trim(),
                scope: document.getElementById('project-scope').value.split('\n').map(s => s.trim()).filter(s => s),
                blockers: document.getElementById('project-blockers').value.split(',').map(b => b.trim()).filter(b => b)
            };

            if (editingId) {
                const index = projects.findIndex(p => p.id === editingId);
                projects[index] = { ...project, id: editingId };
            } else {
                project.id = generateId();
                projects.push(project);
            }

            renderProjects();
            hideModal();
        }

        // Hide modal
        function hideModal() {
            document.getElementById('project-modal').style.display = 'none';
            clearForm();
        }

        // Clear form
        function clearForm() {
            document.getElementById('project-name').value = '';
            document.getElementById('project-owner').value = '';
            document.getElementById('project-team').value = 'Backend Team';
            document.getElementById('project-status').value = 'Idea';
            document.getElementById('project-priority').value = 'Medium';
            document.getElementById('project-start').value = '';
            document.getElementById('project-end').value = '';
            document.getElementById('project-progress').value = '0';
            document.getElementById('project-jira').value = '';
            document.getElementById('project-gitlab').value = '';
            document.getElementById('project-description').value = '';
            document.getElementById('project-vision').value = '';
            document.getElementById('project-scope').value = '';
            document.getElementById('project-blockers').value = '';
        }

        // Export data
        function exportData() {
            const dataStr = JSON.stringify(projects, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
            const exportFileDefaultName = 'roadmap-data.json';
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }

        // Jira Integration
        function updateJiraStatus(connected) {
            const statusEl = document.getElementById('jira-status');
            if (connected) {
                statusEl.textContent = 'Connected';
                statusEl.className = 'jira-status jira-connected';
                jiraConfig.connected = true;
            } else {
                statusEl.textContent = 'Disconnected';
                statusEl.className = 'jira-status jira-disconnected';
                jiraConfig.connected = false;
            }
            sessionStorage.setItem('jiraConfig', JSON.stringify(jiraConfig));
        }

        async function testJiraConnection() {
            const url = document.getElementById('jira-url').value.trim();
            const email = document.getElementById('jira-email').value.trim();
            const token = document.getElementById('jira-token').value.trim();

            if (!url || !email || !token) {
                alert('Please fill in all Jira connection fields');
                return;
            }

            jiraConfig = { url, email, token, connected: false };
            sessionStorage.setItem('jiraConfig', JSON.stringify(jiraConfig));

            try {
                const response = await fetch(`${url}/rest/api/3/myself`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Basic ${btoa(email + ':' + token)}`,
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    }
                });
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`HTTP ${response.status}: ${errorData.errorMessages?.join(', ') || response.statusText}`);
                }
                const user = await response.json();
                updateJiraStatus(true);
                showSyncResults(`‚úÖ Connected successfully! Welcome, ${user.displayName}`, 'success');
            } catch (error) {
                updateJiraStatus(false);
                showSyncResults(`‚ùå Connection failed: ${error.message}`, 'error');
                console.error('Jira connection error:', error);
            }
        }

        async function syncWithJira() {
            if (!jiraConfig.connected) {
                alert('Please test the connection first');
                return;
            }

            try {
                showSyncResults('üîÑ Syncing projects from Jira...', 'info');
                const response = await fetch(`${jiraConfig.url}/rest/api/3/search?jql=type=Epic&fields=summary,status,assignee,created,updated,description`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Basic ${btoa(jiraConfig.email + ':' + jiraConfig.token)}`,
                        'Accept': 'application/json'
                    }
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`HTTP ${response.status}: ${errorData.errorMessages?.join(', ') || response.statusText}`);
                }

                const data = await response.json();
                let syncedCount = 0;

                data.issues.forEach(epic => {
                    const existingProject = projects.find(p => p.jiraEpic === epic.key);
                    if (!existingProject) {
                        const newProject = {
                            id: generateId(),
                            name: epic.fields.summary,
                            status: mapJiraStatus(epic.fields.status.name),
                            priority: 'Medium',
                            startDate: epic.fields.created.split('T')[0],
                            endDate: '',
                            progress: getProgressFromStatus(epic.fields.status.name),
                            team: 'Backend Team',
                            description: parseJiraDescription(epic.fields.description),
                            vision: '',
                            scope: [],
                            blockers: [],
                            jiraEpic: epic.key,
                            gitlabUrl: '',
                            owner: epic.fields.assignee?.displayName || ''
                        };
                        projects.push(newProject);
                        syncedCount++;
                    }
                });

                renderProjects();
                showSyncResults(`‚úÖ Sync completed! ${syncedCount} new projects imported from Jira`, 'success');
            } catch (error) {
                showSyncResults(`‚ùå Sync failed: ${error.message}`, 'error');
                console.error('Jira sync error:', error);
            }
        }

        function mapJiraStatus(jiraStatus) {
            const statusMap = {
                'To Do': 'Idea',
                'In Progress': 'In Progress',
                'Done': 'Completed',
                'Backlog': 'Planning',
                'Selected for Development': 'Planning',
                'In Development': 'In Progress',
                'In Review': 'In Progress',
                'Testing': 'In Progress',
                'Blocked': 'At Risk'
            };
            return statusMap[jiraStatus] || 'Planning';
        }

        function getProgressFromStatus(status) {
            const progressMap = {
                'To Do': 0,
                'Backlog': 0,
                'Selected for Development': 10,
                'In Progress': 50,
                'In Development': 40,
                'In Review': 70,
                'Testing': 80,
                'Done': 100,
                'Blocked': 25
            };
            return progressMap[status] || 0;
        }

        function parseJiraDescription(description) {
            if (!description || !description.content) return 'No description';
            let text = '';
            description.content.forEach(block => {
                if (block.content) {
                    block.content.forEach(item => {
                        if (item.text) text += item.text + ' ';
                    });
                }
            });
            return text.trim() || 'No description';
        }

        function importFromJira() {
            if (!jiraConfig.connected) {
                alert('Please configure and test Jira connection first');
                return;
            }
            syncWithJira();
        }

        function showSyncResults(message, type) {
            const resultsEl = document.getElementById('sync-results');
            resultsEl.innerHTML = message;
            resultsEl.style.display = 'block';
            resultsEl.className = `sync-results ${type}`;
            if (type === 'success' || type === 'error') {
                setTimeout(() => {
                    resultsEl.style.display = 'none';
                }, 5000);
            }
        }

        // Event listeners
        window.onclick = function(event) {
            const modal = document.getElementById('project-modal');
            if (event.target == modal) {
                hideModal();
            }
        };

        document.addEventListener('keydown', (event) => {
            if (event.key === 'Escape') {
                hideModal();
            }
        });

        // Initial setup
        loadFromStorage();
        renderProjects();
    </script>
</body>
</html>
